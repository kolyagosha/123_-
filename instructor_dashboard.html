<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="verification-panel">–ü–∞–Ω–µ–ª—å –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó SSRM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –î–∞—à–±–æ—Ä–¥–∞ */
        .dashboard-layout {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
            padding: var(--spacing-xl) 0;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .task-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-lg);
        }

        .task-card {
            border: 1px solid var(--gray-300);
            transition: transform var(--transition-base), box-shadow var(--transition-base);
            position: relative;
        }
        
        .task-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .urgency-badge {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            font-size: var(--font-size-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            color: var(--white);
            font-weight: var(--font-weight-bold);
        }
        
        .urgency-success { background-color: var(--success-color); }
        .urgency-warning { background-color: var(--warning-color); color: var(--gray-900); }
        .urgency-danger { background-color: var(--danger-color); }
        .urgency-dark { background-color: var(--gray-800); } /* –î–ª—è –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏—Ö */

        .task-details {
            font-size: var(--font-size-sm);
            color: var(--gray-700);
        }

        .card-footer-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: space-between;
        }
    </style>
</head>
<body class="d-flex flex-column" style="min-height: 100vh; background: var(--gray-100);">

    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">S</div>
                <span>SSRM</span>
            </a>
            <nav class="nav-controls gap-md">
                <a href="#" class="text-muted fw-semibold" onclick="SSRM.Auth.logout(); window.location.href='index.html';" data-translate="logout">–í–∏—Ö—ñ–¥</a>
                <div class="language-switcher">
                    <button class="lang-btn" data-lang="uk">üá∫üá¶ –£–ö–†</button>
                    <button class="lang-btn" data-lang="en">üá¨üáß ENG</button>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container dashboard-layout">
            
            <h2 class="fw-bold text-gray-800" id="welcomeHeader">
                </h2>
            
            <div class="d-flex justify-content-between align-center flex-wrap gap-md">
                <h4 class="m-0" data-translate="my-tasks">–ú–æ—ó –ó–∞–≤–¥–∞–Ω–Ω—è</h4>
                <div class="d-flex align-center gap-sm">
                    <label for="sortBy" data-translate="sort-by">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞:</label>
                    <select id="sortBy" class="form-control form-select">
                        <option value="deadline" data-translate="sort-deadline">–ó–∞ —Ç–µ—Ä–º—ñ–Ω–æ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (—Å–ø–æ—á–∞—Ç–∫—É –Ω–∞–π—Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—à—ñ)</option>
                        <option value="name" data-translate="sort-name">–ó–∞ –ø—Ä—ñ–∑–≤–∏—â–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
                    </select>
                </div>
            </div>
            
            <div id="taskList" class="task-list">
                </div>

            <div id="loadingIndicator"></div>
            
            <div id="noTasksMessage" class="alert alert-info d-none">
                –£—Ä–∞! –ù–∞—Ä–∞–∑—ñ –≤—Å—ñ –∑–∞–ª—ñ–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ. –ú–æ–∂–Ω–∞ –≤–∏–ø–∏—Ç–∏ –∫–∞–≤–∏.
            </div>

        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">hai-guys.space</div>
            <p class="footer-text" data-translate="footer-text">
                –°—Ç–µ–∂—Ç–µ –∑–∞ –Ω–∞—à–∏–º–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏!
            </p>
        </div>
    </footer>
    
    <script src="main.js"></script> 
    
    <script>
        // –Ü–º—ñ—Ç–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ (—Ü–µ —ñ–º—ñ—Ç—É—î –¥–∞–Ω—ñ, –æ—Ç—Ä–∏–º–∞–Ω—ñ –∑ –±–∞–∑–∏)
        const mockTasks = [
            { id: 'T001', studentId: 'S001', studentName: '–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω', faculty: '–ü–ú', group: '–ü–ú-21', controlWord: 'ALPHA123', P1: 72, P2: 145, P3: 90, submissionDate: new Date(Date.now() - (3 * 24 * 60 * 60 * 1000)), videoUrl: 'video_ivanov.mp4', assignedTo: 'I001' }, // –ù–∞–¥—ñ—Å–ª–∞–Ω–æ 3 –¥–Ω—ñ —Ç–æ–º—É
            { id: 'T002', studentId: 'S002', studentName: '–ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞', faculty: '–Æ–†', group: '–Æ–†-20', controlWord: 'BETA456', P1: 65, P2: 160, P3: 70, submissionDate: new Date(Date.now() - (12 * 24 * 60 * 60 * 1000)), videoUrl: 'video_petrova.mp4', assignedTo: 'I001' }, // –ù–∞–¥—ñ—Å–ª–∞–Ω–æ 12 –¥–Ω—ñ–≤ —Ç–æ–º—É (–¢–µ—Ä–º—ñ–Ω–æ–≤–æ!)
            { id: 'T003', studentId: 'S003', studentName: '–°–∏–¥–æ—Ä–æ–≤ –û–ª–µ–≥', faculty: '–ï–ö', group: '–ï–ö-22', controlWord: 'GAMMA789', P1: 80, P2: 130, P3: 80, submissionDate: new Date(Date.now() - (15 * 24 * 60 * 60 * 1000)), videoUrl: 'video_sidorov.mp4', assignedTo: 'I001' }, // –ù–∞–¥—ñ—Å–ª–∞–Ω–æ 15 –¥–Ω—ñ–≤ —Ç–æ–º—É (–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ!)
            { id: 'T004', studentId: 'S004', studentName: '–ö–æ–≤–∞–ª—å—á—É–∫ –í.', faculty: '–ê–†–•', group: '–ê–†–•-23', controlWord: 'DELTA007', P1: 68, P2: 140, P3: 85, submissionDate: new Date(Date.now() - (6 * 24 * 60 * 60 * 1000)), videoUrl: 'video_kovalchuk.mp4', assignedTo: 'I002' }, // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–æ —ñ–Ω—à–æ–º—É (–Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ)
        ];
        
        // =====================================
        // –§–£–ù–ö–¶–Ü–Ø –†–ï–ù–î–ï–†–ò–ù–ì–£ –ö–ê–†–¢–û–ö –ó–ê–í–î–ê–ù–¨
        // =====================================
        function renderTaskCard(task) {
            const locale = SSRM.langManager.getCurrentLanguage();
            // 1. –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —É—Ç–∏–ª—ñ—Ç–∏ –∑ main.js
            const urgency = SSRM.calculateUrgency(task.submissionDate);
            
            // 2. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –¥–ª—è –∑–Ω–∞—á–∫–∞ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ
            let urgencyClass = '';
            if (urgency.daysLeft > 7) { urgencyClass = 'urgency-success'; } 
            else if (urgency.daysLeft <= 7 && urgency.daysLeft > 0) { urgencyClass = 'urgency-warning'; } 
            else if (urgency.daysLeft <= 0) { urgencyClass = 'urgency-dark'; } 

            const card = document.createElement('div');
            card.className = 'card task-card rounded-lg';
            card.dataset.taskId = task.id;

            // –ó–±–∏—Ä–∞—î–º–æ HTML-–∫–∞—Ä—Ç—É
            card.innerHTML = `
                <div class="card-body">
                    <div class="urgency-badge ${urgencyClass}">
                        <span data-translate="deadline-days">–¢–µ—Ä–º—ñ–Ω</span>: ${urgency.displayDays}
                    </div>
                    
                    <h4 class="mb-2">${task.studentName} (${task.group})</h4>
                    <div class="task-details">
                        <p class="m-0 mb-1"><span class="fw-semibold" data-translate="faculty">–§–∞–∫—É–ª—å—Ç–µ—Ç:</span> ${task.faculty}</p>
                        <p class="m-0 mb-1"><span class="fw-semibold" data-translate="control-word-label">–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–µ –°–ª–æ–≤–æ:</span> <span class="text-danger fw-bold">${task.controlWord}</span></p>
                        <p class="m-0 mb-3"><span class="fw-semibold" data-translate="recovery-indicators">–ü–æ–∫–∞–∑–Ω–∏–∫–∏ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:</span> P1=${task.P1} / P2=${task.P2} / P3=${task.P3}</p>
                    </div>

                    <div class="form-group mb-3">
                        <label for="comments-${task.id}" class="form-label" data-translate="comments">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –í–∏–∫–ª–∞–¥–∞—á–∞:</label>
                        <textarea id="comments-${task.id}" class="form-control" rows="2" placeholder="–ó–∞—É–≤–∞–∂–µ–Ω–Ω—è, —è–∫—â–æ —î..."></textarea>
                    </div>

                    <a href="${task.videoUrl}" target="_blank" class="btn btn-outline btn-block mb-3 fw-semibold" data-translate="watch-video">
                        –î–ò–í–ò–¢–ò–°–Ø –ë–ï–ó–ü–ï–†–ï–†–í–ù–ï –í–Ü–î–ï–û
                    </a>

                    <div class="card-footer-actions">
                        <button class="btn btn-success btn-sm flex-fill grade-btn" data-grade="PASS" data-task-id="${task.id}" data-translate="grade-pass">
                            –ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –ó–ê–õ–Ü–ö
                        </button>
                        <button class="btn btn-danger btn-sm flex-fill grade-btn" data-grade="FAIL" data-task-id="${task.id}" data-translate="grade-fail">
                            –ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –ù–ï–ó–ê–õ–Ü–ö
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        // =====================================
        // –§–£–ù–ö–¶–Ü–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –Ü –°–û–†–¢–£–í–ê–ù–ù–Ø
        // =====================================
        function loadTasks(instructorId, sortBy = 'deadline') {
            const taskListContainer = document.getElementById('taskList');
            const noTasksMessage = document.getElementById('noTasksMessage');
            
            // 1. –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è: –ü–æ–∫–∞–∑—É—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ —Ç—ñ–ª—å–∫–∏ —Ü—å–æ–º—É –≤–∏–∫–ª–∞–¥–∞—á—É
            const filteredTasks = mockTasks.filter(task => task.assignedTo === instructorId);

            // 2. –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
            if (sortBy === 'deadline') {
                 filteredTasks.sort((a, b) => {
                    const urgencyA = SSRM.calculateUrgency(a.submissionDate);
                    const urgencyB = SSRM.calculateUrgency(b.submissionDate);
                    // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –¥–Ω—ñ–≤ –¥–æ –¥–µ–¥–ª–∞–π–Ω—É (–º–µ–Ω—à–µ = —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—à–µ)
                    return urgencyA.daysLeft - urgencyB.daysLeft;
                });
            } else if (sortBy === 'name') {
                 filteredTasks.sort((a, b) => a.studentName.localeCompare(b.studentName));
            }


            taskListContainer.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫
            
            if (filteredTasks.length === 0) {
                noTasksMessage.classList.remove('d-none');
                return;
            } else {
                noTasksMessage.classList.add('d-none');
            }

            // 3. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ–∫
            filteredTasks.forEach(task => {
                taskListContainer.appendChild(renderTaskCard(task));
            });
            
            // 4. –î–æ–¥–∞–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è
            attachGradingListeners();
        }

        // =====================================
        // –§–£–ù–ö–¶–Ü–Ø –û–ë–†–û–ë–ö–ò –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø
        // =====================================
        function attachGradingListeners() {
            document.querySelectorAll('.grade-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const taskId = e.target.dataset.taskId;
                    const grade = e.target.dataset.grade;
                    const commentsEl = document.getElementById(`comments-${taskId}`);
                    const comments = commentsEl.value;
                    
                    // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—ñ —Ç—É—Ç –±—É–≤ –±–∏ AJAX-–∑–∞–ø–∏—Ç –¥–æ API
                    // –∑ –¥–∞–Ω–∏–º–∏: taskId, grade, comments

                    const taskCard = document.querySelector(`[data-task-id="${taskId}"]`);
                    
                    // –Ü–º—ñ—Ç–∞—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
                    taskCard.style.opacity = 0.5;
                    SSRM.toast.success(`${SSRM.langManager.translate('grade-saved')} –û—Ü—ñ–Ω–∫–∞: ${grade}`, 4000);
                    
                    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø—ñ—Å–ª—è "–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è"
                    setTimeout(() => {
                        taskCard.remove();
                        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–ª–∏—à–∏–ª–∏—Å—è –∑–∞–≤–¥–∞–Ω–Ω—è
                        if (document.getElementById('taskList').children.length === 0) {
                            document.getElementById('noTasksMessage').classList.remove('d-none');
                        }
                    }, 1000); 
                });
            });
        }
        
        // =====================================
        // –ì–û–õ–û–í–ù–ê –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
        // =====================================
        document.addEventListener('DOMContentLoaded', () => {
            SSRM.langManager.init(); 
            const currentUser = SSRM.Auth.getCurrentUser();
            const welcomeHeader = document.getElementById('welcomeHeader');
            const sortBySelect = document.getElementById('sortBy');

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
            if (!SSRM.Auth.isAuthenticated() || currentUser.type === 'student') {
                window.location.href = 'instructor_login.html';
                return;
            }
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ —ñ–º'—è –≤–∏–∫–ª–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è
            const instructorAccount = SSRM.mockInstructorAccounts.find(acc => acc.id === currentUser.id);
            const name = instructorAccount ? instructorAccount.name : '–í–∏–∫–ª–∞–¥–∞—á';
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Ä–æ–ª—ñ
            let welcomeMessageKey = currentUser.type === 'hod' ? 'welcome-hod' : 'welcome-professor';
            const initialTaskCount = mockTasks.filter(task => task.assignedTo === currentUser.id).length;
            
            welcomeHeader.textContent = `${SSRM.langManager.translate(welcomeMessageKey)} ${name}! –ó–∞–≤–¥–∞–Ω—å –≤ —Ä–æ–±–æ—Ç—ñ: ${initialTaskCount}`;

            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
            loadTasks(currentUser.id, sortBySelect.value);
            
            // –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
            sortBySelect.addEventListener('change', (e) => {
                loadTasks(currentUser.id, e.target.value);
            });

            // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ –º–æ–≤–∏
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // –ü–æ–≤—Ç–æ—Ä–Ω–æ –æ–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —ñ –∑–∞–≤–¥–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –º–æ–≤–∏
                    setTimeout(() => {
                        welcomeHeader.textContent = `${SSRM.langManager.translate(welcomeMessageKey)} ${name}! –ó–∞–≤–¥–∞–Ω—å –≤ —Ä–æ–±–æ—Ç—ñ: ${initialTaskCount}`;
                        loadTasks(currentUser.id, sortBySelect.value); // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞–¥—É —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ
                    }, 50);
                });
            });
        });
    </script>
</body>
</html>
