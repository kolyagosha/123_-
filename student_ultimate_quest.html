<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–∞ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è | SSRM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page-specific styles */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            padding: var(--spacing-xl) var(--spacing-lg);
        }

        .quest-container {
            max-width: 900px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease-out;
        }

        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
            padding: var(--spacing-2xl);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .page-title {
            color: var(--white);
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-extrabold);
            margin-bottom: var(--spacing-md);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .page-description {
            color: rgba(255, 255, 255, 0.95);
            font-size: var(--font-size-lg);
            line-height: 1.6;
        }

        .quest-badge {
            display: inline-block;
            background: rgba(255, 215, 0, 0.3);
            color: var(--white);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-md);
            animation: pulse 2s ease-in-out infinite;
        }

        .step-card {
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .step-header {
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-xl);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .step-header.step-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: var(--white);
        }

        .step-header.step-primary {
            background: var(--primary-gradient);
            color: var(--white);
        }

        .step-header.step-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: var(--gray-900);
        }

        .step-header.step-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: var(--white);
        }

        .step-icon {
            font-size: var(--font-size-3xl);
            flex-shrink: 0;
        }

        .step-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            margin: 0;
        }

        .control-word-display {
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            text-align: center;
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .control-word-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .control-word-label {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--spacing-sm);
        }

        .control-word {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-extrabold);
            color: var(--white);
            letter-spacing: 0.2em;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            font-family: 'Courier New', monospace;
            position: relative;
            z-index: 1;
        }

        .instruction-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .instruction-list li {
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--primary-color);
            display: flex;
            gap: var(--spacing-md);
        }

        .instruction-number {
            background: var(--primary-color);
            color: var(--white);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            flex-shrink: 0;
        }

        .pulse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .pulse-input-group {
            text-align: center;
        }

        .pulse-label {
            display: block;
            font-weight: var(--font-weight-semibold);
            color: var(--gray-700);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .pulse-input {
            width: 100%;
            padding: var(--spacing-lg);
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            text-align: center;
            border: 3px solid var(--gray-300);
            border-radius: var(--radius-lg);
            transition: all var(--transition-base);
        }

        .pulse-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: scale(1.05);
        }

        .video-upload-area {
            border: 3px dashed var(--gray-300);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            text-align: center;
            transition: all var(--transition-base);
            background: var(--gray-50);
            cursor: pointer;
        }

        .video-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .video-upload-area.has-file {
            border-color: var(--success-color);
            background: rgba(40, 167, 69, 0.05);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        .video-upload-area.has-file .upload-icon {
            opacity: 1;
        }

        .file-info {
            display: none;
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--white);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--success-color);
        }

        .file-info.show {
            display: block;
        }

        .confirm-checkbox {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid var(--warning-color);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            margin: var(--spacing-xl) 0;
        }

        .submit-button {
            width: 100%;
            padding: var(--spacing-xl);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            position: relative;
            overflow: hidden;
        }

        .submit-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .submit-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .submit-button span {
            position: relative;
            z-index: 1;
        }

        .progress-indicator {
            display: none;
            margin-top: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .progress-indicator.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: var(--spacing-md) 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            width: 0;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: var(--font-weight-bold);
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: var(--font-size-2xl);
            }

            .control-word {
                font-size: var(--font-size-2xl);
                letter-spacing: 0.1em;
            }

            .pulse-grid {
                grid-template-columns: 1fr;
            }

            .step-card {
                padding: var(--spacing-xl);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">S</div>
                <span>SSRM</span>
            </a>
            <nav class="nav-controls">
                <div class="language-switcher">
                    <button class="lang-btn active" data-lang="uk">üá∫üá¶ –£–ö–†</button>
                    <button class="lang-btn" data-lang="en">üá¨üáß ENG</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="quest-container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="quest-badge">üèÜ –û—Ñ—ñ—Ü—ñ–π–Ω–∞ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è</div>
                <h1 class="page-title" data-translate="quest-title">
                    –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–∞ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (–ó–∞–ª—ñ–∫ –∑–∞ –°–µ–º–µ—Å—Ç—Ä!)
                </h1>
                <p class="page-description" data-translate="quest-description">
                    –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤–µ—Å—å –∫–æ–º–ø–ª–µ–∫—Å –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ. –ó–∞–≥–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—ñ–¥–µ–æ ‚Äî –¥–æ 5 —Ö–≤–∏–ª–∏–Ω.
                </p>
            </div>

            <form id="questSubmissionForm">
                <!-- Step 1: Verification -->
                <div class="step-card">
                    <div class="step-header step-success">
                        <div class="step-icon">üîê</div>
                        <h2 class="step-title" data-translate="quest-step1">
                            –ö—Ä–æ–∫ 1: –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –ü–æ—á–∞—Ç–æ–∫
                        </h2>
                    </div>

                    <div class="card-body">
                        <p class="text-center mb-2">
                            <strong>1.</strong> –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ —Ç–∞ –∑–∞–ø–∏—à—ñ—Ç—å —Å–ª–æ–≤–æ.
                        </p>

                        <div class="control-word-display">
                            <div class="control-word-label" data-translate="control-word">
                                –ö–û–ù–¢–†–û–õ–¨–ù–ï –°–õ–û–í–û:
                            </div>
                            <div class="control-word" id="controlWordDisplay">
                                LOADING
                            </div>
                        </div>

                        <p class="text-center text-muted" data-translate="control-word-instruction">
                            <strong>2.</strong> –£–≤—ñ–º–∫–Ω—ñ—Ç—å –∑–∞–ø–∏—Å —Ç–∞ <strong>–≥–æ–ª–æ—Å–Ω–æ –≤–∏–º–æ–≤—Ç–µ —Ü–µ —Å–ª–æ–≤–æ</strong> –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –≤–ø—Ä–∞–≤.
                        </p>
                    </div>
                </div>

                <!-- Step 2: Exercise Complex -->
                <div class="step-card">
                    <div class="step-header step-primary">
                        <div class="step-icon">üí™</div>
                        <h2 class="step-title" data-translate="quest-step2">
                            –ö—Ä–æ–∫ 2: –ö–æ–º–ø–ª–µ–∫—Å –í–ø—Ä–∞–≤ (–ú–∞–∫—Å–∏–º—É–º 3 –•–≤–∏–ª–∏–Ω–∏)
                        </h2>
                    </div>

                    <div class="card-body">
                        <ol class="instruction-list">
                            <li>
                                <div class="instruction-number">1</div>
                                <div>
                                    <strong data-translate="pulse-before">P1 (–ü—É–ª—å—Å –¥–æ):</strong> 
                                    –í–∏–º—ñ—Ä—è–π—Ç–µ —Ç–∞ –∑–∞–ø–∏—à—ñ—Ç—å –ø—É–ª—å—Å –¥–æ –ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—Å—É.
                                </div>
                            </li>
                            <li>
                                <div class="instruction-number">2</div>
                                <div>
                                    <strong>–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è:</strong> 30 –ø–æ–≤—Ç–æ—Ä—ñ–≤ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—é —Ç–µ—Ö–Ω—ñ–∫–æ—é.
                                </div>
                            </li>
                            <li>
                                <div class="instruction-number">3</div>
                                <div>
                                    <strong>–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è:</strong> 20 –ø–æ–≤—Ç–æ—Ä—ñ–≤ (–≥–ª–∏–±–æ–∫—ñ –ø—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è).
                                </div>
                            </li>
                            <li>
                                <div class="instruction-number">4</div>
                                <div>
                                    <strong>–ü–ª–∞–Ω–∫–∞:</strong> –£—Ç—Ä–∏–º–∞–Ω–Ω—è 30 —Å–µ–∫—É–Ω–¥ (—Ä—ñ–≤–Ω–∞ —Å–ø–∏–Ω–∞).
                                </div>
                            </li>
                            <li>
                                <div class="instruction-number">5</div>
                                <div>
                                    –ù–∞ –≤—ñ–¥–µ–æ –º–∞—î –±—É—Ç–∏ –≤–∏–¥–Ω–æ <strong>—Ç–∞–π–º–µ—Ä</strong> (–¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —á–∞—Å—É &lt; 3 —Ö–≤).
                                </div>
                            </li>
                        </ol>
                    </div>
                </div>

                <!-- Step 3: Recovery Tracking -->
                <div class="step-card">
                    <div class="step-header step-warning">
                        <div class="step-icon">‚ù§Ô∏è</div>
                        <h2 class="step-title" data-translate="quest-step3">
                            –ö—Ä–æ–∫ 3: –§—ñ–∫—Å–∞—Ü—ñ—è –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
                        </h2>
                    </div>

                    <div class="card-body">
                        <p class="text-muted text-center mb-3">
                            –í–≤–µ–¥—ñ—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—è –ø—É–ª—å—Å—É –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫–æ–º–ø–ª–µ–∫—Å—É:
                        </p>

                        <div class="pulse-grid">
                            <div class="pulse-input-group">
                                <label class="pulse-label" data-translate="pulse-before">
                                    P1 (–î–æ)
                                </label>
                                <input 
                                    type="number" 
                                    class="pulse-input" 
                                    id="pulseP1" 
                                    placeholder="72"
                                    min="40"
                                    max="200"
                                    required>
                            </div>
                            <div class="pulse-input-group">
                                <label class="pulse-label" data-translate="pulse-after">
                                    P2 (–ü—ñ—Å–ª—è)
                                </label>
                                <input 
                                    type="number" 
                                    class="pulse-input" 
                                    id="pulseP2" 
                                    placeholder="155"
                                    min="40"
                                    max="220"
                                    required>
                            </div>
                            <div class="pulse-input-group">
                                <label class="pulse-label" data-translate="pulse-recovery">
                                    P3 (1 —Ö–≤)
                                </label>
                                <input 
                                    type="number" 
                                    class="pulse-input" 
                                    id="pulseP3" 
                                    placeholder="95"
                                    min="40"
                                    max="200"
                                    required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Video Upload -->
                <div class="step-card">
                    <div class="step-header step-danger">
                        <div class="step-icon">üìπ</div>
                        <h2 class="step-title" data-translate="quest-step4">
                            –ö—Ä–æ–∫ 4: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –î–æ–∫–∞–∑—ñ–≤
                        </h2>
                    </div>

                    <div class="card-body">
                        <label for="videoUpload" class="form-label" data-translate="upload-video">
                            –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –≤—ñ–¥–µ–æ –∫–æ–º–ø–ª–µ–∫—Å—É (–º–∞–∫—Å. 50 –ú–ë):
                        </label>

                        <div class="video-upload-area" id="uploadArea">
                            <div class="upload-icon">üìπ</div>
                            <p><strong>–ö–ª–∞—Ü–Ω—ñ—Ç—å</strong> –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –≤—ñ–¥–µ–æ —Å—é–¥–∏</p>
                            <p class="text-muted" style="font-size: var(--font-size-sm);">
                                –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏: MP4, MOV, AVI (–º–∞–∫—Å. 50 –ú–ë)
                            </p>
                            <input 
                                type="file" 
                                id="videoUpload" 
                                accept="video/*"
                                style="display: none;"
                                required>
                        </div>

                        <div class="file-info" id="fileInfo">
                            <strong>–û–±—Ä–∞–Ω–∏–π —Ñ–∞–π–ª:</strong>
                            <div id="fileName" style="margin-top: var(--spacing-sm);"></div>
                            <button type="button" class="btn btn-sm btn-outline mt-2" id="changeFileBtn">
                                –ó–º—ñ–Ω–∏—Ç–∏ —Ñ–∞–π–ª
                            </button>
                        </div>

                        <div class="confirm-checkbox">
                            <div class="form-check">
                                <input 
                                    class="form-check-input" 
                                    type="checkbox" 
                                    id="confirmCheckbox" 
                                    required>
                                <label class="form-check-label" for="confirmCheckbox" data-translate="confirm-completion">
                                    –Ø –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é, —â–æ –≤–∏–∫–æ–Ω–∞–≤ –≤–µ—Å—å –∫–æ–º–ø–ª–µ–∫—Å –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ –∑–∞ —á–∞—Å <strong>–º–µ–Ω—à–µ 3 —Ö–≤–∏–ª–∏–Ω</strong>.
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary submit-button" id="submitQuestButton">
                            <span data-translate="submit-quest">üöÄ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</span>
                        </button>

                        <div class="progress-indicator" id="progressIndicator">
                            <p><strong>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ...</strong></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill">0%</div>
                            </div>
                            <p class="text-muted" style="font-size: var(--font-size-sm);">
                                –ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–µ –∑–∞–∫—Ä–∏–≤–∞–π—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É
                            </p>
                        </div>

                        <div id="submissionMessage" style="margin-top: var(--spacing-lg);"></div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">hai-guys-space</div>
            <p class="footer-text" data-translate="footer-text">
                –°—Ç–µ–∂—Ç–µ –∑–∞ –Ω–∞—à–∏–º–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏!
            </p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // ========================================
        // QUEST PAGE LOGIC
        // ========================================

        let selectedFile = null;

        document.addEventListener('DOMContentLoaded', () => {
            // Generate and display control word
            SSRM.displayControlWord();

            // Setup file upload
            setupFileUpload();

            // Form submission
            document.getElementById('questSubmissionForm').addEventListener('submit', handleQuestSubmission);
        });

        // Setup file upload interactions
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('videoUpload');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const changeFileBtn = document.getElementById('changeFileBtn');

            // Click to upload
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // File selected
            fileInput.addEventListener('change', (e) => {
                handleFileSelect(e.target.files[0]);
            });

            // Change file button
            changeFileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                fileInput.click();
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary-color)';
                uploadArea.style.background = 'rgba(102, 126, 234, 0.1)';
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '';
                uploadArea.style.background = '';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '';
                uploadArea.style.background = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelect(file) {
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('video/')) {
                SSRM.toast.error('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–µ–æ —Ñ–∞–π–ª');
                return;
            }

            // Validate file size (50MB)
            const maxSize = 50 * 1024 * 1024;
            if (file.size > maxSize) {
                SSRM.toast.error('–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π! –ú–∞–∫—Å–∏–º—É–º 50 –ú–ë');
                return;
            }

            selectedFile = file;

            // Update UI
            document.getElementById('uploadArea').classList.add('has-file');
            document.getElementById('fileName').textContent = `üìπ ${file.name} (${formatFileSize(file.size)})`;
            document.getElementById('fileInfo').classList.add('show');

            SSRM.toast.success('–í—ñ–¥–µ–æ –≤–∏–±—Ä–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Handle quest submission
        function handleQuestSubmission(event) {
            event.preventDefault();

            // Get form data
            const controlWord = document.getElementById('controlWordDisplay').textContent;
            const pulseP1 = document.getElementById('pulseP1').value;
            const pulseP2 = document.getElementById('pulseP2').value;
            const pulseP3 = document.getElementById('pulseP3').value;
            const isConfirmed = document.getElementById('confirmCheckbox').checked;

            // Validation
            if (!pulseP1 || !pulseP2 || !pulseP3) {
                SSRM.toast.error('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤—Å—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –ø—É–ª—å—Å—É');
                return;
            }

            if (!selectedFile) {
                SSRM.toast.error('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –≤—ñ–¥–µ–æ');
                return;
            }

            if (!isConfirmed) {
                SSRM.toast.error('–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–ø–ª–µ–∫—Å—É');
                return;
            }

            // Validate pulse values
            if (!SSRM.FormValidator.validateNumber(pulseP1, 40, 200)) {
                SSRM.toast.error('P1 –º–∞—î –±—É—Ç–∏ –º—ñ–∂ 40 —ñ 200');
                return;
            }

            if (!SSRM.FormValidator.validateNumber(pulseP2, 40, 220)) {
                SSRM.toast.error('P2 –º–∞—î –±—É—Ç–∏ –º—ñ–∂ 40 —ñ 220');
                return;
            }

            if (!SSRM.FormValidator.validateNumber(pulseP3, 40, 200)) {
                SSRM.toast.error('P3 –º–∞—î –±—É—Ç–∏ –º—ñ–∂ 40 —ñ 200');
                return;
            }

            // Disable submit button
            const submitBtn = document.getElementById('submitQuestButton');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>';

            // Show progress
            const progressIndicator = document.getElementById('progressIndicator');
            progressIndicator.classList.add('show');

            // Simulate upload progress
            simulateUpload(() => {
                // Create quest result object
                const studentId = SSRM.Storage.get('currentStudentId') || 'S_UNKNOWN';
                const profile = SSRM.Storage.get('studentProfile') || {};

                const questResult = {
                    id: 'Q' + Date.now(),
                    studentId: studentId,
                    studentName: profile.studentName || 'Student',
                    faculty: profile.faculty || 'Unknown',
                    group: profile.group || 'Unknown',
                    dateSubmitted: new Date().toISOString(),
                    controlWordUsed: controlWord,
                    videoFileName: selectedFile.name,
                    videoSize: selectedFile.size,
                    pulseP1: parseInt(pulseP1),
                    pulseP2: parseInt(pulseP2),
                    pulseP3: parseInt(pulseP3),
                    status: '–û—á—ñ–∫—É—î –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ –í–∏–∫–ª–∞–¥–∞—á–µ–º',
                    checkDeadline: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(),
                    assignedInstructorId: profile.assignedInstructorId || 'I001'
                };

                // Save to localStorage (in real app: Firebase)
                SSRM.Storage.set('lastQuestResult', questResult);

                // Show success message
                document.getElementById('submissionMessage').innerHTML = `
                    <div class="alert alert-success">
                        üéâ <strong data-translate="quest-submitted">–¢–µ—Å—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Å—Ç–∞—Ç—É—Å—É...</strong>
                    </div>
                `;

                SSRM.toast.success(SSRM.langManager.translate('quest-submitted'), 3000);

                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = 'student_dashboard.html';
                }, 2000);
            });
        }

        // Simulate upload progress
        function simulateUpload(callback) {
            const progressFill = document.getElementById('progressFill');
            let progress = 0;

            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;

                progressFill.style.width = progress + '%';
                progressFill.textContent = Math.round(progress) + '%';

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(callback, 500);
                }
            }, 200);
        }
    </script>
</body>
</html>
